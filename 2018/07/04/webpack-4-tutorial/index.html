<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="webpack 4 ：从0配置到项目搭建"><meta name="keywords" content="webpack"><meta name="author" content="phoebe,undefined"><meta name="copyright" content="phoebe"><title>webpack 4 ：从0配置到项目搭建 | phoebe's blog</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.3"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><link rel="dns-prefetch" href="https://unpkg.com"><link rel="stylesheet" type="text/css" href="https://unpkg.com/gitment@latest/style/default.css"><script src="https://unpkg.com/gitment@latest/dist/gitment.browser.js"></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  localSearch: undefined
} </script><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body><canvas id="canvas"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0配置，配置了什么"><span class="toc-number">1.</span> <span class="toc-text">0配置，配置了什么</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#entry-amp-output"><span class="toc-number">1.1.</span> <span class="toc-text">entry &amp; output</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#production-amp-development"><span class="toc-number">1.2.</span> <span class="toc-text">production &amp; development</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#总结"><span class="toc-number">1.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#项目搭建"><span class="toc-number">2.</span> <span class="toc-text">项目搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#转换-ES6-代码，解决浏览器兼容问题"><span class="toc-number">2.1.</span> <span class="toc-text">转换 ES6 代码，解决浏览器兼容问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#用-babel-转换-ES6-代码"><span class="toc-number">2.1.1.</span> <span class="toc-text">用 babel 转换 ES6 代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用-babel-polyfill-解决兼容性问题"><span class="toc-number">2.1.2.</span> <span class="toc-text">使用 babel-polyfill 解决兼容性问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编译css，自动添加前缀，抽取css到独立文件"><span class="toc-number">2.2.</span> <span class="toc-text">编译css，自动添加前缀，抽取css到独立文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#复制并压缩html文件-html-webpack-plugin"><span class="toc-number">2.3.</span> <span class="toc-text">复制并压缩html文件 html-webpack-plugin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#打包前清理源目录文件-clean-webpack-plugin"><span class="toc-number">2.4.</span> <span class="toc-text">打包前清理源目录文件 clean-webpack-plugin</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#静态资源处理-file-loader"><span class="toc-number">2.5.</span> <span class="toc-text">静态资源处理 file-loader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#development-模式下启动服务器并实时刷新-webpack-dev-server"><span class="toc-number">2.6.</span> <span class="toc-text">development 模式下启动服务器并实时刷新 webpack-dev-server</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-webpack-4-建立-react-项目"><span class="toc-number">3.</span> <span class="toc-text">使用 webpack 4 建立 react 项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考资源"><span class="toc-number">4.</span> <span class="toc-text">参考资源</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">phoebe</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">7</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">6</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">1</span></a></div></div></div><div id="content-outer"><div class="plain" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">phoebe's blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">首页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">目录</a><a class="site-page" href="/gallery">相册</a></span></div></div><div class="layout" id="content-inner"><article id="post"><div class="plain" id="post-title">webpack 4 ：从0配置到项目搭建</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-07-04</time></div><div id="post-content"><p>webpack4发布以来，我写项目都是用脚手架，即使再简单的项目，真的是really shame。。虽然道听途说了很多 webpack4 的特性，却没有尝试过，因为它给人的感觉就是 ———— 很难。但是今天我从最简单的部分开始，一点点搭建起一个项目。</p>
<h2 id="0配置，配置了什么"><a href="#0配置，配置了什么" class="headerlink" title="0配置，配置了什么"></a>0配置，配置了什么</h2><p>让我们从0开始，新建一个项目，在终端执行以下语句：</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">mkdir</span> webpack-4-quickstart <span class="token operator">&amp;&amp;</span> <span class="token function">cd</span> webpack-4-quickstart
<span class="token function">npm</span> init -y
<span class="token function">npm</span> i webpack --save-dev
<span class="token function">npm</span> i webpack-cli --save-dev
</code></pre>
<p>修改代码 <code>package.json</code> 中 <code>scripts</code> 部分：</p>
<pre class=" language-bash"><code class="language-bash"><span class="token string">"scripts"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
  <span class="token string">"build"</span><span class="token keyword">:</span> <span class="token string">"webpack"</span>
<span class="token punctuation">}</span>
</code></pre>
<p>现在，我们的 <code>package.json</code> 是这样的：</p>
<pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"webpack-4-quickstart"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"webpack"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"ISC"</span><span class="token punctuation">,</span>
  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"webpack"</span><span class="token operator">:</span> <span class="token string">"^4.14.0"</span><span class="token punctuation">,</span>
    <span class="token property">"webpack-cli"</span><span class="token operator">:</span> <span class="token string">"^3.0.8"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>此时，我们执行 <code>npm run build</code>， 会给出以下提示/错误：</p>
<p><img src="/assets/webpack4/webpack4-error-1.png" alt="webpack4-error"></p>
<ol>
<li>error: 没有入口文件</li>
<li>warning: 建议设置 <code>mode</code> 选项</li>
</ol>
<h3 id="entry-amp-output"><a href="#entry-amp-output" class="headerlink" title="entry &amp; output"></a>entry &amp; output</h3><p>为了解决第一个问题，我们尝试新建 <code>src/index.js</code>:</p>
<pre class=" language-js"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`I'm a entry point`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>此时再次执行  <code>npm run build</code>，成功打包出了 <code>dist/main.js</code>,因此我们可以得知：</p>
<blockquote>
<p>webpack4 more配置了 entry（入口） <code>src/index.js</code> 和output（出口） <code>dist/main.js</code></p>
</blockquote>
<p>当然，如果你想覆盖这个配置（比如修改为 <code>./foo/src/js/index.js</code>），可以在 <code>package.json</code> 修改：</p>
<pre class=" language-js"><code class="language-js"><span class="token string">"scripts"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token string">"dev"</span><span class="token punctuation">:</span> <span class="token string">"webpack --mode development ./foo/src/js/index.js --output ./foo/main.js"</span><span class="token punctuation">,</span>
  <span class="token string">"build"</span><span class="token punctuation">:</span> <span class="token string">"webpack --mode production ./foo/src/js/index.js --output ./foo/main.js"</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="production-amp-development"><a href="#production-amp-development" class="headerlink" title="production &amp; development"></a>production &amp; development</h3><p>webpack4 之前，我们写一个项目起码会设置两种类型文件：</p>
<ul>
<li>用于开发环境的webpack.dev.conf.js，定义 webpack 启动的服务器等</li>
<li>用于生产环境的webpack.prod.conf.js，定义UglifyJSPlugin或其他配置等</li>
</ul>
<p>而 webpack4 的 <code>mode</code> 给出了两种配置：<code>development</code> 和 <code>production</code>。</p>
<p>我们修改  <code>package.json</code>  中 <code>scripts</code> 部分：</p>
<pre class=" language-bash"><code class="language-bash"><span class="token string">"scripts"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
  <span class="token string">"dev"</span><span class="token keyword">:</span> <span class="token string">"webpack --mode development"</span>,
  <span class="token string">"build"</span><span class="token keyword">:</span> <span class="token string">"webpack --mode production"</span>
<span class="token punctuation">}</span>
</code></pre>
<p>我们分别执行 <code>npm run dev</code> 和 <code>npm run build</code></p>
<p><img src="/assets/webpack4/webpack4-mode.png" alt="webpack4-mode"></p>
<p>执行 <code>npm run dev</code> 打包的是未压缩的代码，而 <code>npm run build</code> 是压缩后的代码。</p>
<blockquote>
<ul>
<li>生产模式下：启用了 代码压缩、作用域提升（scope hoisting）、 tree-shaking，使代码最精简</li>
<li>开发模式下：相较于更小体积的代码，提供的是打包速度上的优化</li>
</ul>
</blockquote>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>webpack 4 的零配置主要应用于：</p>
<ul>
<li><code>entry</code> 默认设置为 <code>./src/index.js</code></li>
<li><code>output</code> 默认设置为 <code>./dist/main.js</code></li>
<li><code>production</code> 和 <code>development</code> 两种模式</li>
</ul>
<h2 id="项目搭建"><a href="#项目搭建" class="headerlink" title="项目搭建"></a>项目搭建</h2><p>项目搭建，我们对webpack的诉求是：</p>
<ul>
<li>js的处理：转换 ES6 代码，解决浏览器兼容问题</li>
<li>css的处理：编译css，自动添加前缀，抽取css到独立文件</li>
<li>html的处理：复制并压缩html文件</li>
<li>dist的清理：打包前清理源目录文件</li>
<li>assets的处理：静态资源处理</li>
<li>server的启用：development 模式下启动服务器并实时刷新</li>
</ul>
<h3 id="转换-ES6-代码，解决浏览器兼容问题"><a href="#转换-ES6-代码，解决浏览器兼容问题" class="headerlink" title="转换 ES6 代码，解决浏览器兼容问题"></a>转换 ES6 代码，解决浏览器兼容问题</h3><h4 id="用-babel-转换-ES6-代码"><a href="#用-babel-转换-ES6-代码" class="headerlink" title="用 babel 转换 ES6 代码"></a>用 babel 转换 ES6 代码</h4><p>用 babel 转换 ES6 代码需要使用到 <strong>babel-loader</strong> ，我们需要安装一系列的依赖：</p>
<pre class=" language-bash"><code class="language-bash">    <span class="token function">npm</span> i babel-core babel-loader babel-preset-env --save-dev
</code></pre>
<p>然后在根目录新建一个babel配置文件 <code>.babelrc</code>：</p>
<pre class=" language-json"><code class="language-json">    <span class="token punctuation">{</span>
        <span class="token property">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"env"</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>那么如何将配置用于webpack打包中？</p>
<ul>
<li>新建一个 webpack 的配置文件</li>
<li>在 npm scripts 中使用 <code>--module-bind</code></li>
</ul>
<ol>
<li><p>使用 webpack 的配置文件的方法：</p>
<p> 新建 <code>webpack.config.js</code>：</p>
<pre class=" language-js"><code class="language-js">     module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
       module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
         rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
           <span class="token punctuation">{</span>
             test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
             exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
             use<span class="token punctuation">:</span> <span class="token punctuation">{</span>
               loader<span class="token punctuation">:</span> <span class="token string">"babel-loader"</span>
             <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
         <span class="token punctuation">]</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
</code></pre>
</li>
<li><p>在 npm scripts 中配置的方法：</p>
</li>
</ol>
<pre class=" language-json"><code class="language-json">    <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"webpack --mode development --module-bind js=babel-loader"</span><span class="token punctuation">,</span>
      <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"webpack --mode production --module-bind js=babel-loader"</span>
    <span class="token punctuation">}</span>
</code></pre>
<h4 id="使用-babel-polyfill-解决兼容性问题"><a href="#使用-babel-polyfill-解决兼容性问题" class="headerlink" title="使用 babel-polyfill 解决兼容性问题"></a>使用 babel-polyfill 解决兼容性问题</h4><p>然而浏览器依然不支持一些语法的使用，导致兼容性问题，我们用 <code>babel-polyfill</code> 解决：</p>
<pre class=" language-bash"><code class="language-bash">    <span class="token function">npm</span> i babel-polyfill babel-plugin-transform-runtime  --save-dev
</code></pre>
<p><code>.babelrc</code> 添加配置：</p>
<pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"env"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
       <span class="token string">"transform-runtime"</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>最后在 <code>webpack.config.js</code> 中将 <code>babel-polyfill</code> 加到你的 entry 数组中：</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token string">"babel-polyfill"</span><span class="token punctuation">,</span>
        path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="编译css，自动添加前缀，抽取css到独立文件"><a href="#编译css，自动添加前缀，抽取css到独立文件" class="headerlink" title="编译css，自动添加前缀，抽取css到独立文件"></a>编译css，自动添加前缀，抽取css到独立文件</h3><ul>
<li><a href="https://webpack.js.org/loaders/postcss-loader/" target="_blank" rel="noopener">postcss-loader</a></li>
<li><a href="https://github.com/webpack-contrib/mini-css-extract-plugin" target="_blank" rel="noopener">mini-css-extract-plugin</a></li>
</ul>
<p>webpack 并不会主动将你的css代码提取到一个文件，过去我们使用 <code>extract-text-webpack-plugin</code>，在webpack4中我们使用<a href="https://github.com/webpack-contrib/mini-css-extract-plugin" target="_blank" rel="noopener">mini-css-extract-plugin</a>来解决这个问题。</p>
<p>postcss-loader 用于添加浏览器前缀，相关配置我喜欢在根目录新建 <code>postcss.config.js</code> 配置</p>
<pre class=" language-bash"><code class="language-bash">    <span class="token function">npm</span> i mini-css-extract-plugin css-loader --save-dev
    <span class="token function">npm</span> i style-loader postcss-loader  --save-dev
</code></pre>
<pre class=" language-js"><code class="language-js">    <span class="token comment" spellcheck="true">// webpack.config.js</span>
    <span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"mini-css-extract-plugin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">(</span>env<span class="token punctuation">,</span> argv<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> devMode <span class="token operator">=</span> argv<span class="token punctuation">.</span>mode <span class="token operator">!==</span> <span class="token string">'production'</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token comment" spellcheck="true">// ...,</span>
            <span class="token punctuation">{</span>
                test<span class="token punctuation">:</span> <span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
                use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                    devMode <span class="token operator">?</span> <span class="token string">'style-loader'</span> <span class="token punctuation">:</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
                    <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
                    <span class="token string">'postcss-loader'</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token comment" spellcheck="true">// ...,</span>
            <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              filename<span class="token punctuation">:</span> <span class="token string">"[name].css"</span><span class="token punctuation">,</span>
              chunkFilename<span class="token punctuation">:</span> <span class="token string">"[id].css"</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// postcss.config.js</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
        plugins<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            autoprefixer<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
<h3 id="复制并压缩html文件-html-webpack-plugin"><a href="#复制并压缩html文件-html-webpack-plugin" class="headerlink" title="复制并压缩html文件 html-webpack-plugin"></a>复制并压缩html文件 <a href="https://webpack.js.org/guides/output-management/#setting-up-htmlwebpackplugin" target="_blank" rel="noopener">html-webpack-plugin</a></h3><pre class=" language-bash"><code class="language-bash">    <span class="token function">npm</span> i html-webpack-plugin html-loader --save-dev
</code></pre>
<pre class=" language-js"><code class="language-js">    <span class="token comment" spellcheck="true">// webpack.config.js</span>
    <span class="token keyword">const</span> HtmlWebPackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"html-webpack-plugin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
        module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token comment" spellcheck="true">// ...,</span>
                <span class="token punctuation">{</span>
                    test<span class="token punctuation">:</span> <span class="token regex">/\.html$/</span><span class="token punctuation">,</span>
                    use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                        loader<span class="token punctuation">:</span> <span class="token string">"html-loader"</span><span class="token punctuation">,</span>
                        options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                            minimize<span class="token punctuation">:</span> <span class="token boolean">true</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token keyword">new</span> <span class="token class-name">HtmlWebPackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                template<span class="token punctuation">:</span> <span class="token string">"./src/index.html"</span><span class="token punctuation">,</span>
                filename<span class="token punctuation">:</span> <span class="token string">"./index.html"</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="打包前清理源目录文件-clean-webpack-plugin"><a href="#打包前清理源目录文件-clean-webpack-plugin" class="headerlink" title="打包前清理源目录文件 clean-webpack-plugin"></a>打包前清理源目录文件 <a href="https://webpack.js.org/guides/output-management/#cleaning-up-the-dist-folder" target="_blank" rel="noopener">clean-webpack-plugin</a></h3><p>每次打包，都会生成项目的静态资源，随着某些文件的增删，我们的 dist 目录下可能产生一些不再使用的静态资源，webpack并不会自动判断哪些是需要的资源，为了不让这些旧文件也部署到生产环境上占用空间，所以在 webpack 打包前最好能清理 dist 目录。</p>
<pre class=" language-bash"><code class="language-bash">    <span class="token function">npm</span> <span class="token function">install</span> clean-webpack-plugin --save-dev
</code></pre>
<pre class=" language-js"><code class="language-js">  <span class="token keyword">const</span> CleanWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'dist'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="静态资源处理-file-loader"><a href="#静态资源处理-file-loader" class="headerlink" title="静态资源处理 file-loader"></a>静态资源处理 <a href="https://webpack.js.org/loaders/file-loader/" target="_blank" rel="noopener">file-loader</a></h3><pre class=" language-bash"><code class="language-bash">    <span class="token function">npm</span> <span class="token function">install</span> file-loader --save-dev
</code></pre>
<pre class=" language-js"><code class="language-js">    <span class="token comment" spellcheck="true">// webpack.config.js</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
      module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            test<span class="token punctuation">:</span> <span class="token regex">/\.(png|jpg|gif)$/</span><span class="token punctuation">,</span>
            use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">{</span>
                loader<span class="token punctuation">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">,</span>
                options<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre>
<h3 id="development-模式下启动服务器并实时刷新-webpack-dev-server"><a href="#development-模式下启动服务器并实时刷新-webpack-dev-server" class="headerlink" title="development 模式下启动服务器并实时刷新 webpack-dev-server"></a>development 模式下启动服务器并实时刷新 <a href="https://webpack.js.org/configuration/dev-server" target="_blank" rel="noopener">webpack-dev-server</a></h3><pre class=" language-bash"><code class="language-bash">    <span class="token function">npm</span> i webpack-dev-server --save-dev
</code></pre>
<p><code>package.json</code></p>
<pre class=" language-json"><code class="language-json">    <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"webpack-dev-server --mode development --open"</span><span class="token punctuation">,</span>
      <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"webpack --mode production"</span>
    <span class="token punctuation">}</span>
</code></pre>
<h2 id="使用-webpack-4-建立-react-项目"><a href="#使用-webpack-4-建立-react-项目" class="headerlink" title="使用 webpack 4 建立 react 项目"></a>使用 webpack 4 建立 react 项目</h2><p>现在我们模仿 <a href="https://github.com/facebook/create-react-app" target="_blank" rel="noopener">create-react-app</a> 的结构，自己搭建一个 react 项目：</p>
<pre class=" language-bash"><code class="language-bash">  ├── public
  │   └── index.html      <span class="token comment" spellcheck="true"># html 模板</span>
  ├── src
  │   ├── assets          <span class="token comment" spellcheck="true"># 静态资源</span>
  │   │   └── logo.png
  │   ├── components      <span class="token comment" spellcheck="true"># 组件</span>
  │   │   └── App.js
  │   ├── index.js        <span class="token comment" spellcheck="true"># 入口文件</span>
  │   └── styles
  │       └── index.less
  ├── .babelrc
  ├── package-lock.json
  ├── package.json
  ├── postcss.config.js
  └── webpack.config.js
</code></pre>
<p>在以上的基础，再安装react相关模块：</p>
<pre class=" language-bash"><code class="language-bash">    <span class="token function">npm</span> i react react-dom --save-dev
    <span class="token function">npm</span> i babel-preset-react --save-dev
</code></pre>
<p>修改 <code>.babelrc</code>:</p>
<pre class=" language-json"><code class="language-json">    <span class="token punctuation">{</span>
      <span class="token property">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"env"</span><span class="token punctuation">,</span> <span class="token string">"react"</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>修改 <code>webpack.config.js</code> ：</p>
<pre class=" language-js"><code class="language-js">    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
      module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            test<span class="token punctuation">:</span> <span class="token regex">/\.(js|jsx)$/</span><span class="token punctuation">,</span>
            exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
            use<span class="token punctuation">:</span> <span class="token punctuation">{</span>
              loader<span class="token punctuation">:</span> <span class="token string">"babel-loader"</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="参考资源"><a href="#参考资源" class="headerlink" title="参考资源"></a>参考资源</h2><ul>
<li><a href="https://webpack.js.org/concepts/" target="_blank" rel="noopener">webpack documentation</a></li>
<li><a href="https://www.valentinog.com/blog/webpack-tutorial/" target="_blank" rel="noopener">Webpack 4 Tutorial: from 0 Conf to Production Mode</a></li>
</ul>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">phoebe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://phoebecodespace.github.io/2018/07/04/webpack-4-tutorial/">https://phoebecodespace.github.io/2018/07/04/webpack-4-tutorial/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://phoebecodespace.github.io" target="_blank">phoebe's blog</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/webpack/">webpack</a></div><nav id="pagination"><div class="next-post pull-right"><a href="/2018/06/30/create-react-chat-app/"><span>react + socket.io 创建简易聊天室</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitment-container"></div><script>var gitment = new Gitment({
  owner: 'phoebeCodeSpace',
  repo: 'https://github.com/phoebeCodeSpace',
  oauth: {
    client_id: 'f1e167c99c113cb54fde',
    client_secret: 'dfc6a8de063ebe17850d4cb2edb151fda96c3b1b'
  }
})
gitment.render('gitment-container')</script></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 By phoebe</div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.3"></script><script src="/js/fancybox.js?version=1.5.3"></script><script src="/js/sidebar.js?version=1.5.3"></script><script src="/js/copy.js?version=1.5.3"></script><script src="/js/fireworks.js?version=1.5.3"></script><script src="/js/transition.js?version=1.5.3"></script><script src="/js/scroll.js?version=1.5.3"></script><script src="/js/head.js?version=1.5.3"></script><script src="/js/3d-bg.js"></script></body></html>