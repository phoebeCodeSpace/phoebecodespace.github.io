<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="vue-cli 3.0 特性速读"><meta name="keywords" content="vue"><meta name="author" content="phoebe,undefined"><meta name="copyright" content="phoebe"><title>vue-cli 3.0 特性速读 | phoebe's blog</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css?version=1.5.3"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><link rel="dns-prefetch" href="https://unpkg.com"><link rel="stylesheet" type="text/css" href="https://unpkg.com/gitment@latest/style/default.css"><script src="https://unpkg.com/gitment@latest/dist/gitment.browser.js"></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  localSearch: undefined
} </script><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body><canvas id="canvas"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#新建项目"><span class="toc-number">1.</span> <span class="toc-text">新建项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#功能配置"><span class="toc-number">2.</span> <span class="toc-text">功能配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#功能选择"><span class="toc-number">2.1.</span> <span class="toc-text">功能选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#功能细节配置"><span class="toc-number">2.2.</span> <span class="toc-text">功能细节配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vue-config-js-自定义配置"><span class="toc-number">3.</span> <span class="toc-text">vue.config.js 自定义配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#设置代理"><span class="toc-number">3.1.</span> <span class="toc-text">设置代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#启用dll"><span class="toc-number">3.2.</span> <span class="toc-text">启用dll</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#静态资源路径"><span class="toc-number">3.3.</span> <span class="toc-text">静态资源路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack配置修改"><span class="toc-number">3.4.</span> <span class="toc-text">webpack配置修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#全局变量的设置"><span class="toc-number">3.5.</span> <span class="toc-text">全局变量的设置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#填坑"><span class="toc-number">4.</span> <span class="toc-text">填坑</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">phoebe</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">10</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">9</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">1</span></a></div></div></div><div id="content-outer"><div class="plain" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">phoebe's blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">首页</a><a class="site-page" href="/archives">归档</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">目录</a><a class="site-page" href="/gallery">相册</a></span></div></div><div class="layout" id="content-inner"><article id="post"><div class="plain" id="post-title">vue-cli 3.0 特性速读</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-04-19</time></div><div id="post-content"><p>最近的开发项目中使用了vue-cli 3.0，使用体验可以说非常棒了，模板更加制定化，配置更加简洁。以下总结下应用过程中的一些经验。</p>
<h2 id="新建项目"><a href="#新建项目" class="headerlink" title="新建项目"></a>新建项目</h2><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 安装</span>
<span class="token function">npm</span> <span class="token function">install</span> -g @vue/cli

<span class="token comment" spellcheck="true"># 新建项目</span>
vue create my-project

<span class="token comment" spellcheck="true"># 项目启动</span>
<span class="token function">npm</span> run serve

<span class="token comment" spellcheck="true"># 打包</span>
<span class="token function">npm</span> run build
</code></pre>
<p>打包后的文件，对引用资源注入了预加载（<code>preload/prefetch</code>），启用 PWA 插件时注入 <code>manifest/icon</code> 链接，并且引入(inlines) webpack runtime / chunk manifest 清单已获得最佳性能。</p>
<h2 id="功能配置"><a href="#功能配置" class="headerlink" title="功能配置"></a>功能配置</h2><h3 id="功能选择"><a href="#功能选择" class="headerlink" title="功能选择"></a>功能选择</h3><p><img src="/assets/vue-cli-3-select.png" alt="功能选择"></p>
<p>3.0 版本包括<strong>默认预设配置</strong> 和 <strong>用户自定义配置</strong>，在用户自定义配置之后，会询问是否保存当前的配置功能为将来的项目配置的预设值，这样下次可直接使用不需要再次配置。</p>
<p>自定义功能配置包括以下功能：</p>
<ul>
<li>TypeScript</li>
<li>Progressive Web App (PWA) Support</li>
<li>Router</li>
<li>Vuex</li>
<li>CSS Pre-processors</li>
<li>Linter / Formatter</li>
<li>Unit Testing</li>
<li>E2E Testing</li>
</ul>
<p>可以根据项目大小和功能体验配置不同的功能，<code>空格键</code> 选中/反选，<code>按a键</code> 全选/全不选，<code>按i键</code>反选已选择项， <code>上下键</code> 上下移动选择。</p>
<h3 id="功能细节配置"><a href="#功能细节配置" class="headerlink" title="功能细节配置"></a>功能细节配置</h3><p><img src="/assets/vue-cli-3-setting.png" alt="功能配置"></p>
<p>在选择功能后，会询问更细节的配置，</p>
<ul>
<li>TypeScript：<ul>
<li>是否使用class风格的组件语法：<code>Use class-style component syntax?</code></li>
<li>是否使用babel做转义：<code>Use Babel alongside TypeScript for auto-detected polyfills?</code></li>
</ul>
</li>
<li>CSS Pre-processors：<ul>
<li>选择CSS 预处理类型：<code>Pick a CSS pre-processor</code></li>
</ul>
</li>
<li>Linter / Formatter<ul>
<li>选择Linter / Formatter规范类型：<code>Pick a linter / formatter config</code></li>
<li>选择lint方式，保存时检查/提交时检查：<code>Pick additional lint features</code></li>
</ul>
</li>
<li>Testing<ul>
<li>选择Unit测试方式</li>
<li>选择E2E测试方式</li>
</ul>
</li>
<li>选择 Babel, PostCSS, ESLint 等自定义配置的存放位置 <code>Where do you prefer placing config for Babel, PostCSS, ESLint, etc.?</code></li>
</ul>
<h2 id="vue-config-js-自定义配置"><a href="#vue-config-js-自定义配置" class="headerlink" title="vue.config.js 自定义配置"></a>vue.config.js 自定义配置</h2><p><a href="https://github.com/vuejs/vue-cli/blob/dev/docs/config.md" target="_blank" rel="noopener">vue.config.js完整默认配置</a></p>
<pre class=" language-js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// 基本路径</span>
  baseUrl<span class="token punctuation">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// 输出文件目录</span>
  outputDir<span class="token punctuation">:</span> <span class="token string">'dist'</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// eslint-loader 是否在保存的时候检查</span>
  lintOnSave<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// use the full build with in-browser compiler?</span>
  <span class="token comment" spellcheck="true">// https://vuejs.org/v2/guide/installation.html#Runtime-Compiler-vs-Runtime-only</span>
  compiler<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// webpack配置</span>
  <span class="token comment" spellcheck="true">// see https://github.com/vuejs/vue-cli/blob/dev/docs/webpack.md</span>
  chainWebpack<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  configureWebpack<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// vue-loader 配置项</span>
  <span class="token comment" spellcheck="true">// https://vue-loader.vuejs.org/en/options.html</span>
  vueLoader<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// 生产环境是否生成 sourceMap 文件</span>
  productionSourceMap<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// css相关配置</span>
  css<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 是否使用css分离插件 ExtractTextPlugin</span>
    extract<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true">// 开启 CSS source maps?</span>
    sourceMap<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true">// css预设器配置项</span>
    loaderOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true">// 启用 CSS modules for all css / pre-processor files.</span>
    modules<span class="token punctuation">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// use thread-loader for babel &amp; TS in production build</span>
  <span class="token comment" spellcheck="true">// enabled by default if the machine has more than 1 cores</span>
  parallel<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cpus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// 是否启用dll</span>
  <span class="token comment" spellcheck="true">// See https://github.com/vuejs/vue-cli/blob/dev/docs/cli-service.md#dll-mode</span>
  dll<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// PWA 插件相关配置</span>
  <span class="token comment" spellcheck="true">// see https://github.com/vuejs/vue-cli/tree/dev/packages/%40vue/cli-plugin-pwa</span>
  pwa<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// webpack-dev-server 相关配置</span>
  devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    open<span class="token punctuation">:</span> process<span class="token punctuation">.</span>platform <span class="token operator">===</span> <span class="token string">'darwin'</span><span class="token punctuation">,</span>
    host<span class="token punctuation">:</span> <span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span>
    port<span class="token punctuation">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>
    https<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    hotOnly<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    proxy<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 设置代理</span>
    before<span class="token punctuation">:</span> app <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment" spellcheck="true">// 第三方插件配置</span>
  pluginOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="设置代理"><a href="#设置代理" class="headerlink" title="设置代理"></a>设置代理</h3><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># string</span>
module.exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  devServer: <span class="token punctuation">{</span>
    proxy: <span class="token string">'&lt;url>'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true"># Object</span>
module.exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  devServer: <span class="token punctuation">{</span>
    proxy: <span class="token punctuation">{</span>
      <span class="token string">'/api'</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
        target: <span class="token string">'&lt;url>'</span>,
        ws: true,
        changeOrigin: <span class="token boolean">true</span>
      <span class="token punctuation">}</span>,
      <span class="token string">'/foo'</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
        target: <span class="token string">'&lt;other_url>'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="启用dll"><a href="#启用dll" class="headerlink" title="启用dll"></a>启用dll</h3><p>启用<code>dll</code>后，我们的动态库文件每次打包生成的<code>vendor</code>的<code>[chunkhash]</code>值就会一样，其值可以是 <code>true/false</code>,也可以制定<code>特定的代码库</code>。</p>
<pre class=" language-bash"><code class="language-bash">module.exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  dll: <span class="token boolean">true</span>
<span class="token punctuation">}</span>

module.exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  dll: <span class="token punctuation">[</span>
    <span class="token string">'dep-a'</span>,
    <span class="token string">'dep-b/some/nested/file.js'</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="静态资源路径"><a href="#静态资源路径" class="headerlink" title="静态资源路径"></a>静态资源路径</h3><ul>
<li><p>相对路径</p>
<ul>
<li>静态资源路径以 <code>@</code>  开头代表  <code>&lt;projectRoot&gt;/src</code></li>
<li>静态资源路径以 <code>~</code>  开头，可以引入<code>node modules</code>内的资源</li>
</ul>
</li>
<li><p><code>public</code>文件夹里的静态资源引用</p>
<pre class=" language-bash"><code class="language-bash">    <span class="token comment" spellcheck="true"># 在 public/index.html中引用静态资源</span>
    <span class="token operator">&lt;</span>%<span class="token operator">=</span> webpackConfig.output.publicPath %<span class="token operator">></span>
    <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"shortcut icon"</span> href<span class="token operator">=</span><span class="token string">"&lt;%= webpackConfig.output.publicPath %>favicon.ico"</span><span class="token operator">></span>

    <span class="token comment" spellcheck="true"># vue templates中，需要在data中定义baseUrl</span>
    <span class="token operator">&lt;</span>template<span class="token operator">></span>
      <span class="token operator">&lt;</span>img :src<span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">`</span>$<span class="token punctuation">{</span>baseUrl<span class="token punctuation">}</span>my-image.png<span class="token variable">`</span></span>"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>/template<span class="token operator">></span>
    <span class="token operator">&lt;</span>script<span class="token operator">></span>
      data <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          baseUrl: process.env.BASE_URL
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>/script<span class="token operator">></span>
</code></pre>
</li>
</ul>
<h3 id="webpack配置修改"><a href="#webpack配置修改" class="headerlink" title="webpack配置修改"></a>webpack配置修改</h3><p>用 <code>webpack-chain</code> 修改webpack相关配置，强烈建议先熟悉<a href="https://github.com/mozilla-neutrino/webpack-chain#getting-started" target="_blank" rel="noopener">webpack-chain</a>和<a href="https://github.com/vuejs/vue-cli/tree/dev/packages/%40vue/cli-service/lib/config" target="_blank" rel="noopener">vue-cli 源码</a>，以便更好地理解这个选项的配置项。</p>
<ul>
<li>对模块处理配置</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  chainWebpack<span class="token punctuation">:</span> config <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>module
      <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">'js'</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>include
          <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token regex">/some-module-to-transpile/</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">// 要处理的模块</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>修改webpack Loader配置</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  chainWebpack<span class="token punctuation">:</span> config <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>module
      <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">'scss'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'sass-loader'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>options <span class="token operator">=</span><span class="token operator">></span>
        <span class="token function">merge</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token punctuation">{</span>
          includePaths<span class="token punctuation">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'node_modules'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>修改webpack Plugin配置</li>
</ul>
<pre class=" language-js"><code class="language-js"><span class="token comment" spellcheck="true">// vue.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  chainWebpack<span class="token punctuation">:</span> config <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    config
      <span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>args <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token comment" spellcheck="true">/* new args to pass to html-webpack-plugin's constructor */</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>eg: 在本次项目较小，只对<a href="https://github.com/webpack-contrib/uglifyjs-webpack-plugin" target="_blank" rel="noopener">uglifyjs</a>进行了少量的修改，后期如果还有配置上优化会继续添加。</p>
</blockquote>
<pre class=" language-js"><code class="language-js">chainWebpack<span class="token punctuation">:</span> config <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>NODE_ENV <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        config
            <span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'uglify'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// 去除 console.log</span>
                <span class="token keyword">return</span> <span class="token punctuation">[</span>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> <span class="token punctuation">{</span>
                    uglifyOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span> compress<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                        drop_console <span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                        pure_funcs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'console.log'</span><span class="token punctuation">]</span>
                    <span class="token punctuation">}</span><span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="全局变量的设置"><a href="#全局变量的设置" class="headerlink" title="全局变量的设置"></a>全局变量的设置</h3><p>在项目根目录创建以下项目：</p>
<pre class=" language-bash"><code class="language-bash">.env                <span class="token comment" spellcheck="true"># 在所有环节中执行</span>
.env.local          <span class="token comment" spellcheck="true"># 在所有环境中执行，git会ignored</span>
.env.<span class="token punctuation">[</span>mode<span class="token punctuation">]</span>         <span class="token comment" spellcheck="true"># 只在特定环境执行( [mode] 可以是 "development", "production" or "test" )</span>
.env.<span class="token punctuation">[</span>mode<span class="token punctuation">]</span>.local   <span class="token comment" spellcheck="true"># 在特定环境执行, git会ignored</span>


.env.development    <span class="token comment" spellcheck="true"># 只在生产环境执行</span>
.env.production     <span class="token comment" spellcheck="true"># 只在开发环境执行</span>
</code></pre>
<p>在文件里配置键值对：</p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 键名须以VUE_APP开头</span>
VUE_APP_SECRET<span class="token operator">=</span>secret
</code></pre>
<p>在项目中访问：</p>
<pre class=" language-bash"><code class="language-bash">console.log<span class="token punctuation">(</span>process.env.VUE_APP_SECRET<span class="token punctuation">)</span>
</code></pre>
<p>这样项目中的 <code>process.env.VUE_APP_SECRET</code> 就会被 <code>secret</code> 所替代。</p>
<h2 id="填坑"><a href="#填坑" class="headerlink" title="填坑"></a>填坑</h2><ol>
<li><a href="https://github.com/vuejs/vue-cli/issues/1162" target="_blank" rel="noopener">运行 <code>npm run serve</code> 提示错误： <code>error: You must pass the &quot;decoratorsLegacy&quot;: true option to @babel/preset-stage-2</code></a></li>
</ol>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 解决办法1： 在package.json中指定@babel/preset-stage-2版本</span>
<span class="token string">"devDependencies"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
  <span class="token string">"@babel/preset-stage-2"</span><span class="token keyword">:</span> <span class="token string">"7.0.0-beta.44"</span>,
  <span class="token punctuation">..</span>.
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true"># 解决办法2： 修改.babelrc</span>
<span class="token punctuation">{</span>
  <span class="token string">"presets"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">"@babel/preset-env"</span>, <span class="token punctuation">{</span>
      <span class="token string">"targets"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
        <span class="token string">"browsers"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
          <span class="token string">"> 5%"</span>,
          <span class="token string">"last 2 versions"</span>,
          <span class="token string">"not ie &lt;= 8"</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>,
      <span class="token string">"modules"</span><span class="token keyword">:</span> false,
      <span class="token string">"exclude"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
        <span class="token string">"transform-regenerator"</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>,
    <span class="token punctuation">[</span><span class="token string">"@babel/preset-stage-2"</span>, <span class="token punctuation">{</span>
      <span class="token string">"useBuiltIns"</span><span class="token keyword">:</span> true,
      <span class="token string">"decoratorsLegacy"</span><span class="token keyword">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span>,
  <span class="token string">"plugins"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>vue-cli 3 就项目性能而言已经相当友好了，私有制定性也特别强，各种配置也特别贴心，可以根据项目大小和特性制定私有预设，对前期项目搭建而言效率极大提升了。</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">phoebe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://phoebecodespace.github.io/2018/04/19/vue-cli-3-briefly-analyzes/">https://phoebecodespace.github.io/2018/04/19/vue-cli-3-briefly-analyzes/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://phoebecodespace.github.io" target="_blank">phoebe's blog</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/vue/">vue</a></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2018/05/03/react-dnd-guide/"><i class="fa fa-chevron-left">  </i><span>拖拽组件：React DnD 的使用</span></a></div><div class="next-post pull-right"><a href="/2018/04/17/typescript-intro/"><span>typescript入门指南</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitment-container"></div><script>var gitment = new Gitment({
  owner: 'phoebeCodeSpace',
  repo: 'https://github.com/phoebeCodeSpace',
  oauth: {
    client_id: 'f1e167c99c113cb54fde',
    client_secret: 'dfc6a8de063ebe17850d4cb2edb151fda96c3b1b'
  }
})
gitment.render('gitment-container')</script></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2018 By phoebe</div><div class="busuanzi"><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="/js/third-party/anime.min.js"></script><script src="/js/third-party/jquery.min.js"></script><script src="/js/third-party/jquery.fancybox.min.js"></script><script src="/js/third-party/velocity.min.js"></script><script src="/js/third-party/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.5.3"></script><script src="/js/fancybox.js?version=1.5.3"></script><script src="/js/sidebar.js?version=1.5.3"></script><script src="/js/copy.js?version=1.5.3"></script><script src="/js/fireworks.js?version=1.5.3"></script><script src="/js/transition.js?version=1.5.3"></script><script src="/js/scroll.js?version=1.5.3"></script><script src="/js/head.js?version=1.5.3"></script><script src="/js/3d-bg.js"></script></body></html>